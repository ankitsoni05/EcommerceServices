# Docker Compose Architecture - Visual Reference

## ??? Complete System Architecture

```
???????????????????????????????????????????????????????????????????????
?                         HOST MACHINE                                ?
?                                                                     ?
?  Browser/Postman                    Docker Desktop                 ?
?       ?                                    ?                        ?
?       ?                                    ?                        ?
?  http://localhost:5001         Docker Compose CLI                  ?
?  http://localhost:5050         (docker-compose up)                 ?
?       ?                                    ?                        ?
???????????????????????????????????????????????????????????????????????
        ?                                    ?
        ?                                    ?
????????????????????????????????????????????????????????????????????????
?       ?              DOCKER COMPOSE ORCHESTRATION                    ?
?       ?                  (ecommerce-network)                         ?
?       ?                                                              ?
?       ?  ????????????????????????????????????????????????????      ?
?       ?  ?            PRESENTATION LAYER                     ?      ?
?       ?  ?                                                   ?      ?
?       ????  ????????????????  ????????????????  ??????????????   ?
?          ?  ?   Catalog    ?  ?    Order     ?  ?   Basket    ?   ?
?          ?  ?   Service    ?  ?   Service    ?  ?   Service   ?   ?
?          ?  ?   :5001      ?  ?   :5002      ?  ?   :5003     ?   ?
?          ?  ?              ?  ?  (Future)    ?  ?  (Future)   ?   ?
?          ?  ????????????????  ????????????????  ???????????????   ?
?          ??????????????????????????????????????????????????????????
?                     ?                ?                 ?            ?
?                     ?  APPLICATION LAYER               ?            ?
?                     ?  (Clean Architecture)            ?            ?
?                     ?                                  ?            ?
?          ??????????????????????????????????????????????????????    ?
?          ?          ?     INFRASTRUCTURE LAYER         ?      ?    ?
?          ?          ?                                  ?      ?    ?
?          ?  ????????????????  ????????????????  ??????????????    ?
?          ?  ?              ?  ?              ?  ?           ??    ?
?          ?  ?  PostgreSQL  ?  ?   MongoDB    ?  ?   Redis   ??    ?
?          ?  ?    :5432     ?  ?   :27017     ?  ?   :6379   ??    ?
?          ?  ?              ?  ?              ?  ?           ??    ?
?          ?  ? ???????????? ?  ?              ?  ?  Cache &  ??    ?
?          ?  ? ?CatalogDb ? ?  ?  ReviewsDb   ?  ?  Sessions ??    ?
?          ?  ? ?OrderDb   ? ?  ?  LogsDb      ?  ?           ??    ?
?          ?  ? ?IdentityDb? ?  ?              ?  ?           ??    ?
?          ?  ? ???????????? ?  ?              ?  ?           ??    ?
?          ?  ?              ?  ?              ?  ?           ??    ?
?          ?  ?  Volume:     ?  ?  Volume:     ?  ?  Volume:  ??    ?
?          ?  ?  postgres-   ?  ?  mongo-      ?  ?  redis-   ??    ?
?          ?  ?  data        ?  ?  data        ?  ?  data     ??    ?
?          ?  ????????????????  ????????????????  ??????????????    ?
?          ????????????????????????????????????????????????????     ?
?                                                                    ?
?          ????????????????????????????????????????????????????    ?
?          ?     DEVELOPMENT TOOLS (Dev Only)                 ?    ?
?          ?                                                   ?    ?
?          ?  ????????????????  ????????????????  ?????????????? ?
?          ?  ?   pgAdmin    ?  ? Mongo Express?  ?   Redis     ? ?
?          ?  ?   :5050      ?  ?   :8081      ?  ? Commander   ? ?
?          ?  ?              ?  ?              ?  ?   :8082     ? ?
?          ?  ? PostgreSQL   ?  ?  MongoDB     ?  ?   Redis     ? ?
?          ?  ? Management   ?  ?  Management  ?  ? Management  ? ?
?          ?  ????????????????  ????????????????  ??????????????? ?
?          ????????????????????????????????????????????????????????
?                                                                    ?
??????????????????????????????????????????????????????????????????????
```

---

## ?? Service Communication Flow

### Request Flow (Get Catalog Item)

```
1. Client Request
   Browser/Postman
        ?
        ? http://localhost:5001/api/catalog/1
        ?
   ???????????????????????
   ?  Docker Port Map    ?
   ?  5001 ? 80          ?
   ???????????????????????
              ?

2. Presentation Layer
   ????????????????????????
   ?  CatalogController   ?
   ?  (HTTP Handler)      ?
   ????????????????????????
              ? calls
              ?

3. Application Layer
   ????????????????????????
   ?  CatalogService      ?
   ?  (Business Logic)    ?
   ????????????????????????
              ? uses
              ?

4. Domain Layer
   ????????????????????????
   ?  ICatalogRepository  ?
   ?  (Interface)         ?
   ????????????????????????
              ? implemented by
              ?

5. Infrastructure Layer
   ????????????????????????
   ?  EfCoreCatalog       ?
   ?  Repository          ?
   ????????????????????????
              ? queries
              ?

6. Database
   ????????????????????????
   ?  PostgreSQL          ?
   ?  postgres:5432       ? ? Service name as hostname!
   ?  CatalogDb           ?
   ????????????????????????
              ? returns data
              ?

7. Response travels back up the chain
   Database ? Repository ? Service ? Controller ? Client
```

---

## ?? Network Architecture

### Docker Network: ecommerce-network

```
????????????????????????????????????????????????????
?          ecommerce-network (bridge)              ?
?                                                  ?
?  catalog-service    ?  postgres:5432            ?
?        ?            ?  redis:6379               ?
?     (can connect using service names)           ?
?                                                  ?
?  order-service      ?  postgres:5432            ?
?        ?            ?  redis:6379               ?
?                                                  ?
?  basket-service     ?  redis:6379               ?
?                     ?  mongodb:27017            ?
?                                                  ?
?  All services can discover each other!          ?
????????????????????????????????????????????????????

Connection strings inside network:
? Host=postgres;Port=5432;Database=CatalogDb
? mongodb://mongodb:27017/
? redis:6379

From host machine:
? Host=localhost;Port=5432;Database=CatalogDb
? mongodb://localhost:27017/
? localhost:6379
```

---

## ?? Port Mapping

### External (Host) ? Internal (Container)

```
?????????????????????????????????????????????????
?  HOST MACHINE         CONTAINER               ?
?????????????????????????????????????????????????
?  localhost:5001    ?  catalog-service:80      ?
?  localhost:5002    ?  order-service:80        ?
?  localhost:5003    ?  basket-service:80       ?
?                                               ?
?  localhost:5432    ?  postgres:5432           ?
?  localhost:27017   ?  mongodb:27017           ?
?  localhost:6379    ?  redis:6379              ?
?                                               ?
?  localhost:5050    ?  pgadmin:80              ?
?  localhost:8081    ?  mongo-express:8081      ?
?  localhost:8082    ?  redis-commander:8081    ?
?????????????????????????????????????????????????
```

---

## ?? Volume Management

### Persistent Data Storage

```
????????????????????????????????????????????????
?  Docker Volumes                              ?
????????????????????????????????????????????????
?                                              ?
?  postgres-data  ?  /var/lib/postgresql/data ?
?     ?? CatalogDb/                           ?
?     ?? OrderDb/                             ?
?     ?? IdentityDb/                          ?
?                                              ?
?  mongo-data     ?  /data/db                 ?
?     ?? ReviewsDb/                           ?
?     ?? LogsDb/                              ?
?                                              ?
?  redis-data     ?  /data                    ?
?     ?? dump.rdb (persistence file)          ?
?                                              ?
????????????????????????????????????????????????

Data persists even when containers are stopped!
Remove with: docker-compose down -v
```

---

## ?? Startup Sequence

### Service Dependencies

```
1. Networks Created
   ???????????????????
   ? ecommerce-      ?
   ? network         ?
   ???????????????????
            ?

2. Volumes Created
   ???????????????????
   ? postgres-data   ?
   ? mongo-data      ?
   ? redis-data      ?
   ???????????????????
            ?

3. Databases Started
   ???????????????????
   ? PostgreSQL      ? ? Runs init scripts
   ? MongoDB         ?
   ? Redis           ?
   ???????????????????
            ? (health checks)
            ?

4. Wait for Healthy
   ???????????????????
   ? All DBs report  ?
   ? healthy status  ?
   ???????????????????
            ?

5. Services Started
   ???????????????????
   ? Catalog Service ?
   ? Order Service   ?
   ? Basket Service  ?
   ???????????????????
            ?

6. Ready!
   All services can communicate
```

---

## ?? Configuration Files

### File Structure and Purpose

```
EcommerceServices/
?
??? docker-compose.yml              ? Main configuration
?   ?? Networks definition
?   ?? Volumes definition
?   ?? Services definition
?   ?? Base configuration
?
??? docker-compose.override.yml     ? Development overrides
?   ?? Volume mounts (hot reload)
?   ?? Development tools enabled
?   ?? Debug ports
?
??? docker-compose.prod.yml         ? Production overrides
?   ?? Resource limits
?   ?? Service scaling
?   ?? Security hardening
?   ?? No development tools
?
??? .env                            ? Environment variables
?   ?? Passwords
?   ?? Ports
?   ?? Configuration values
?
??? databases/
    ??? postgres/
        ??? init-scripts/           ? Database initialization
            ?? 00-create-multiple-databases.sh
            ?? 01-catalog-db.sql
            ?? 02-order-db.sql
```

---

## ?? Scaling Strategy

### Horizontal Scaling

```
Development (Single Instance)
????????????????
?   Catalog    ?
?   Service    ?
?   :5001      ?
????????????????
        ?
   PostgreSQL

Production (Multiple Instances)
????????????????  ????????????????  ????????????????
?   Catalog    ?  ?   Catalog    ?  ?   Catalog    ?
?   Service #1 ?  ?   Service #2 ?  ?   Service #3 ?
?   :5001      ?  ?   :5002      ?  ?   :5003      ?
????????????????  ????????????????  ????????????????
       ?                 ?                 ?
       ?????????????????????????????????????
                         ?
                   Load Balancer
                         ?
                   PostgreSQL

Command: docker-compose up -d --scale catalog-service=3
```

---

## ?? Development vs Production

### Configuration Differences

```
????????????????????????????????????????????????????????
?  Aspect         ?  Development  ?  Production        ?
????????????????????????????????????????????????????????
?  Hot Reload     ?  ? Enabled   ?  ? Disabled       ?
?  Volume Mounts  ?  ? Source    ?  ? No mounts      ?
?  Debug Ports    ?  ? Exposed   ?  ? Not exposed    ?
?  Dev Tools      ?  ? Enabled   ?  ? Disabled       ?
?  Resource Limit ?  ? None      ?  ? CPU & Memory   ?
?  Replicas       ?  1            ?  2-3 (scalable)    ?
?  Logging        ?  Verbose      ?  Warning/Error     ?
?  Health Checks  ?  ? Enabled   ?  ? Enabled        ?
????????????????????????????????????????????????????????
```

---

## ? Complete System Status

### Healthy System Output

```bash
$ docker-compose ps

NAME                    STATUS              PORTS
????????????????????????????????????????????????????????
catalog-service         Up (healthy)        0.0.0.0:5001->80/tcp
postgres                Up (healthy)        0.0.0.0:5432->5432/tcp
mongodb                 Up (healthy)        0.0.0.0:27017->27017/tcp
redis                   Up (healthy)        0.0.0.0:6379->6379/tcp
pgadmin                 Up                  0.0.0.0:5050->80/tcp
mongo-express           Up                  0.0.0.0:8081->8081/tcp
redis-commander         Up                  0.0.0.0:8082->8081/tcp
```

---

## ?? Quick Reference Commands

```bash
# Start everything
docker-compose up -d

# View logs (all services)
docker-compose logs -f

# View logs (specific service)
docker-compose logs -f catalog-service

# Check status
docker-compose ps

# Stop everything
docker-compose down

# Stop and remove volumes (DELETES DATA!)
docker-compose down -v

# Rebuild and start
docker-compose up --build -d

# Scale a service
docker-compose up -d --scale catalog-service=3

# Access container shell
docker-compose exec catalog-service bash
docker-compose exec postgres psql -U postgres

# Production deployment
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

---

*Complete visual reference for Docker Compose architecture!* ??
